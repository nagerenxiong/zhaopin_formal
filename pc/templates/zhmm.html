<!DOCTYPE HTML>
<html>
	<!-- Added by HTTrack -->
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<!-- /Added by HTTrack -->
<head>
	<meta charset="UTF-8">
	<meta name="description" content="">
	<meta name="keywords" content="">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=9" />
	<title>找回密码</title>
	<link href="{{ STATIC_URL }}css/bootstrap.css" media="screen" rel="stylesheet" type="text/css">
	<link href="{{ STATIC_URL }}css/style.css" media="screen" rel="stylesheet" type="text/css">
	<script src="{{ STATIC_URL }}js/jquery-1.11.3.min.js" ></script>
	<script src="{{ STATIC_URL }}js/radio.js"></script>
	<script src="{{ STATIC_URL }}js/Validform_v5.3.2.js"></script>
	<script src="{{ STATIC_URL }}bootstrap.min.js" ></script>
	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	<script src="http://apps.bdimg.com/libs/html5shiv/3.7/html5shiv.min.js"></script>
	<script src="http://apps.bdimg.com/libs/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->
    <script>
var hash={
    'qq.com': 'http://mail.qq.com',
    'gmail.com': 'http://mail.google.com',
    'sina.com': 'http://mail.sina.com.cn',
    '163.com': 'http://mail.163.com',
    '126.com': 'http://mail.126.com',
    'yeah.net': 'http://www.yeah.net/',
    'sohu.com': 'http://mail.sohu.com/',
    'tom.com': 'http://mail.tom.com/',
    'sogou.com': 'http://mail.sogou.com/',
    '139.com': 'http://mail.10086.cn/',
    'hotmail.com': 'http://www.hotmail.com',
    'live.com': 'http://login.live.com/',
    'live.cn': 'http://login.live.cn/',
    'live.com.cn': 'http://login.live.com.cn',
    '189.com': 'http://webmail16.189.cn/webmail/',
    'yahoo.com.cn': 'http://mail.cn.yahoo.com/',
    'yahoo.cn': 'http://mail.cn.yahoo.com/',
    'eyou.com': 'http://www.eyou.com/',
    '21cn.com': 'http://mail.21cn.com/',
    '188.com': 'http://www.188.com/',
    'foxmail.coom': 'http://www.foxmail.com'
};
    $(document).ready(function() {
        $(".registed").Validform({tiptype:2})
	});
	</script>
<script type="text/javascript">
    $(function() {
        GetRandomNum($("#captcha_lable"));
        GetRandomNum($("#mobile_captcha_lable"));
    })

    function GetRandomNum(obj)
    {
        var random="";
        for(var i=0;i<6;i++)
        {
            random+=Math.floor(Math.random()*10);
        }

        $(obj).text(random);
        $(obj).next().val(random);
    }

  var _hmt = _hmt || [];
  var timer = null;
  var alertFram;
  window.alert = function(txt, type, fun1) {
    var icon = "";
    var qrStr = ""
    clearInterval(timer);
    timer = setInterval(function() {
      if ($("#alertFram")[0]) {
        $("#alertFram").remove();
        clearInterval(timer);
      }
    }, 3900)
    alertFram = $('<div id="alertFram" style="color:#ed4f30;font-size:14px;padding:0px 0px 0px 30px;height:40px;background-color:#fff3de;border:1px solid #ffddc1;position:fixed;left:50%;z-index:999999999;text-align:center;line-height:40px;top:0">' + txt + '<img onclick="$(this).parent().remove()" src="/static/images/x_03.png" style="float:right;cursor:pointer;margin-left:10px;margin-top:14px;margin-right:10px" width="12" height="12"></div>')
    if (arguments[1] != null) {
      if (arguments[1] == 1) {
        icon = "alert_03";
      } else if (arguments[1] == 2) {
        icon = "alert_07";
      } else if (arguments[1] == 3) {
        clearInterval(timer);
        icon = "alert_15";
        qrStr = '<div style="margin-top:20px"><input type="button" id="qr_btn" value="确认" style="width:70px;height:30px;\
               line-height:30px;color:#fff;background-color:#5C91D9;border:0px;border-radius: 5px;font-size:14px"/><input type="button"\
               value="取消" onclick="$(this).parent().parent().remove()" style="width:70px;height:30px;line-\
               height:30px;color:#232323;background-color:#fff;border:0px;border-radius: 5px;font-size:14px"/></div>';
      } else if (arguments[1] == 4) {
        icon = "alert_18";
      }
      alertFram = $('<div id="alertFram" style="color:#232323;font-size:18px;box-shadow: 5px 5px 5px rgba(0,0,0,.4);background-color:#fff;border:1px solid #7E9CC6;border-radius: 5px;position:fixed;left:50%;z-index:999999999;text-align:center;top:50%;padding:10px 20px"><div style="width:200px;float:left"></div><div style="clear:both"></div><img onclick="$(this).parent().remove()" src="/static/images/alert_11.png" style="float:right;cursor:pointer;margin-right:-9px;" ><img src="/static/images/' + icon + '.png" style="vertical-align:middle;margin-right:10px"/>' + txt + '' + qrStr + '</div>')
    }
    if ($("#alertFram")[0]) {
      return;
    }
    $("body").append(alertFram);
    $("#qr_btn").click(function() {
      fun1();
    })
    var width = parseInt(alertFram.css('width'))+40;
    if(arguments[1] != null)
    {
         var height = parseInt(alertFram.height())+20;
         alertFram.css('margin-top', '-' + height/2 + 'px');
    }
    alertFram.css('margin-left', '-' + width/2 + 'px');
  } 
</script>
</head>
<style>
	html,body{width: 100%;height: 100%;}
</style>
<body>
	<!-- 顶部 -->
	<!-- <div class="re_top">
		<div class="center">
			<img src="{{ STATIC_URL }}images/logo.png" alt=""></div>
	</div> -->
	<!-- 顶部 -->
	<!-- banner图 -->
	<div style="height:100%;width:100%;" class="re_banner lo_banner">
    <!-- <h1>本周已有<span>1</span><span>5</span><span>0</span><span>0</span><span>0</span>人在许愿树许愿</h1> -->
		<div class="re_form_box lo_form_box">
			<dl class="re_form_container lo_form_container" id="zhmm">
				<dt class="clearfix">
					<div class="f_r re_form_title_r">
{#						<a href="#" target="_blank" class="c_a6 fz14"></a>#}
<!-- <a style="color:#D21D30;" href="/system/generalRegister" class="c_50 fz14"><span class="c_a6 fz14">没有账号？</span>立即注册</a> <i class="icon-fangxiang2 iconfont"></i> -->
					</div>
					<div class="f_l">
					<a href="/lindex">
						<img src="{{ STATIC_URL }}images/login_logo.gif" alt="" class="va_bottom"></a>
						<span class="c_3a fz20">找回密码</span>
					</div>
				</dt>
                <dd class="buzhou"> 
                    <ul class="center">
                        <li class="active">1</li>
                        <li class="li2">2</li>
                        <li class="f_r">3</li>
                        <span style="top:15px;"></span>
                        <span style="top:15px;right:252px;"></span>
                     </ul>
                     <ul class="center word">
                        <li>请输入邮箱地址或手机号</li>
                        <li class="li2" >验证邮箱 <br>验证手机</li>
                        <li class="li3 f_r">重置密码</li>
                     </ul>
                </dd>
                <div class="clear"></div>
                <dd class="form slide" style="display:block">
                <input type="text" id="account" placeholder="请输入您的注册邮箱/注册手机号" >
                <div class="clear"></div>
                <input type="text" id="verification" placeholder="请输入验证码" style="width: 200px;">
                <span style="width:200px;padding-left: 20px; cursor: pointer;word-spacing:8px; letter-spacing: 5px;" class="tip" title="点击刷新验证码" id="captcha_lable" ></span>
                <img src="/static/images/iconfont-shuaxin.png" onclick="GetRandomNum($(this).prev())"  alt="" style="cursor:pointer">
                <input type="hidden" id="captcha_input" >
                <div class="clear"></div>
                <input type="submit" class="zhmm" onclick="retrievePwd() " value="找回密码" >
                </dd>
                <dd class="yzyz slide" style="display:none">
                    <ul class="center">
                        <li>密码重置邮件已发送到您的邮箱:<span id="email" class="red"></span></li>
                        <li>请在24小时内登录邮箱接收邮件，点击邮件内的链接可重置密码</li>
                        <li><a id="yx" class="btn" target="_blank" href="">登录邮箱查看</a></li>
                    </ul>
                </dd>
                <dd class="yzsj slide" style="display:none">
                    <ul class="center" style="height: 320px;">
                        <li style="margin-top:30px;">获取手机验证码，验证您的手机:<span id="phone" class="red"></span></li>
                        <input id="phone_validation_code" class="txt" type="text" maxlength="6"  placeholder="请输入您手机收到的验证码" required="required">
                        <input id="cxfs" class="cxfs" type="button" style="width: 150px;" onclick="smsValidation()" value="获取手机验证码">
                        <li><input type="submit" class="btn" onclick="validation()" value="验证" ></li>

                        <!-- <div class="show_code" style="display: none;">
                       <input name="mobile_captcha" id="mobile_captcha" maxlength="6" size="6" class="captcha text" autocomplete="off" type="text">

                       <span style="cursor: pointer;" class="tip" onclick="GetRandomNum(this)" title="点击刷新验证码" id="mobile_captcha_lable"></span>
                        <input value="" id="mobile_captcha_input" type="hidden">
                        <a class="r-send-valicode btn-css3" href="javascript:;" onclick="smsValidation()" style="padding:5px 20px;margin:10px 0 0 0;font-size: 14px;">确认发送</a>
                       <a onclick="$('.show_code').hide()" class="close-send-valicode graybtn" href="javascript:;" style="padding:5px 15px;margin:10px 0 0 0;font-size: 14px;">取消</a>

                </div> -->
                    </ul>
                </dd>
                <dd class="czmm slide" style="display:none">
                    <ul class="center">
                    
                        <input id="update_phone" type="hidden" name="phone" value="" >
                        <li> 
                        <input id="pwd" maxlength="16" oncopy="return false;" onpaste="return false;" oncut="return false;" style="margin:10px auto;width:340px;" class="txt" type="password"  placeholder="请输入新密码" required="required">
                        </li>
                        <li> 
                        <input style="margin:10px auto;width:340px;" maxlength="16" oncopy="return false;" onpaste="return false;" oncut="return false;" class="txt" type="password"  placeholder="请再次输新入密码" required="required">
                        </li>
                        <li> <input class="btn" type="submit" value="确定" onclick="resetPwd_phone()"></li>
                        
                    </ul>
                </dd>
			</dl>
		</div>
	</div>
    {#    显示登录返回信息#}
    {% if msg %}
        <script type="text/javascript">
            alert( '{{ msg }}');
        </script>
    {% endif %}

</body>
	<!-- Added by HTTrack -->
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<!-- /Added by HTTrack -->
	<script type="text/javascript">
    function slide(x){
        $(".slide").css("display","none");
        $(".slide").eq(x).css("display","block");
        if(x>1){x=x-1}
        $(".buzhou .center li").eq(0).addClass('active').siblings('li').removeClass('active');
        $(".buzhou .center span").css("background","#DADADA");
        if(x==1){
            $(".buzhou .center li").eq(1).addClass('active');
            $(".buzhou .center span").eq(1).css("background","#5c91d9");
        }
        if(x>1){
            $(".buzhou .center li").addClass('active').siblings('span').css("background","#5c91d9;");
            $(".buzhou .center span").css("background","#5c91d9");
        }
    }
   function retrievePwd(){
       if($("#account").val() == ""){
           window.alert("请输入邮箱地址或手机号",4);
           return;
       }

       if($("#verification").val() == ""){
           window.alert("请输入验证码",4);
           return;
       }

       if(!/^1[0-9]{10}$|^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test($("#account").val())){
            window.alert('账号格式错误，请重新输入正确的邮箱地址或手机号',4);
            $('#zh').val('');
            $('#zh').focus();
            return false;
        }

       if($("#verification").val() != $("#captcha_lable").text()){
           window.alert("请输入正确的验证码",4);
           return;
       }

       $.ajax({
            type: "POST",
            url: "/ajax_valid/",
            data: {
                "type": "account",
                "param": $("#account").val()
            },
            dataType: "text",
            success: function (msg) {
                if (msg == "y") {
                    window.alert("账号不存在，请重新输入",4);
                }
                else{
                    var reg = /^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/

                    if(reg.test($("#account").val())){ //邮件重置
                        $.ajax({
                            type: "POST",
                            url: "/jobs/resetPwd_email_send",
                            data: {
                                "account": $("#account").val()
                            },
                            dataType: "text",
                            success: function (msg) {
                                if (msg == "1") {
                                    $("#email").text($("#account").val());
                                    var account = $("#account").val();
                                    var url = account.split('@')[1];

                                    for (var j in hash){
                                        $("#yx").attr("href", hash[url]);
                                    }

                                    if($("#yx").attr("href")== ""){
                                        $("#yx").attr("href", "http://mail." + url);
                                    }
                                    slide(1);
                                }else{
                                    window.alert("重置密码邮件发送失败，请重试！",4);
                                }
                            }
                        });
                    }
                    else{//手机重置
                        $("#phone").text($("#account").val());
                        slide(2);
                    }
                }
            }
        });
   }
 var count = 120; // 设置短信发送延时
function smsValidation(){
    count=120;
    var reg = /^1[0-9]{10}$/;
    if (reg.test($("#phone").text())){
        $.ajax({
        type: "POST",
        url: "/jobs/ajax_sms_send",
        data: {
            "code": "",
            "mobile": $("#phone").text()
        },
        dataType: "text",
        success: function (msg) {
            if (msg == "1") {
                countdown = setInterval(CountDown, 1000);
                alert("校验码已发送到您的手机，请注意查收！",1);
            } else if(msg == "2") {
                alert("验证码发送失败，请重试！");
            }else{
                alert("验证码输入错误！");
            }
        }
    });
}
else{
    alert("请输入正确的手机号");
}
}
   
    var countdown;
    function CountDown() {
        $("#cxfs").attr("disabled", true);
        $("#cxfs").val(count + " 秒后再次发送");
        if (count == 0) {
            $("#cxfs").val("重新获取验证码").removeAttr("disabled");
            clearInterval(countdown);
        }
        count--;
    }
    function showyzm(){
        $("#mobile_captcha").val("");
        GetRandomNum($("#mobile_captcha_lable"));
        $('.show_code').show()
    }

    //手机验证
    function validation(){
        if($("#phone_validation_code").val() == ""){
            alert("请输入手机收到的验证码");
            return;
        }
        $.ajax({
            type: "POST",
            url: "/jobs/verify_code",
            data: {
                "code": $("#phone_validation_code").val()
            },
            dataType: "text",
            success: function (msg) {
                if (msg == "1") {
                    alert("校验码失效，请重新获取");
                } else if(msg == "2") {
                    alert("校验码错误，请重新输入");
                }else{
                    $("#update_phone").val($("#phone").text());
                    slide(3);
                }
            }
        });
    }

    function resetPwd_phone(){
        if($(".czmm .txt").eq(0).val() != $(".czmm .txt").eq(1).val()){
            alert("两次输入的密码不一致");
            return false;
        }
        else if($(".czmm .txt").eq(0).val().length<6){
            alert("密码长度必须大于6位");
            return false;
        }
        $.ajax({
            type: "POST",
            url: "/resetPwd_phone/",
            data: {
                "phone": $("#update_phone").val(),
                "pwd": $("#pwd").val()
            },
            dataType: "text",
            success: function (msg) {
                if (msg == "success") {
                    alert("您的密码重置成功,3秒后自动跳转到首页");
                    setTimeout(function () {
                        window.location.href='/jobs/index'
                    }, 3000)
                }
                else {
                    if (msg == "success") {
                        alert("您的密码重置成功,3秒后自动跳转到首页");

                    }
                    else {
                        alert("密码重置失败,请重试");
                    }
                }
            }
        });
    }
	</script>
</html>