{% include 'jobs/system/header.html' %}
<link href="{{ STATIC_URL }}css/bootstrap.css" media="screen" rel="stylesheet" type="text/css">
<link href="{{ STATIC_URL }}css/style.css" media="screen" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="{{ STATIC_URL }}css/kongjian.css">
<script src="{{ STATIC_URL }}js/scroll.js" ></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/pagination.js"></script>
<div class="clear">99</div>
	<!-- 内容大框 -->
	<div class="lt_content_box">
		<div class="center clearfix">
			<!-- 修改个人信息 -->
			<dl class="grxx_info f_l ">
				<dt class="bd_bottom1">
					<span><a href="wdgz" class="fc">关注的人</a></span>
                    {% if request.session.account_type != "2" and request.session.account_type != "4" %}
					    <span><a style="color:#777" href="gz_gzdqy">关注的企业</a></span>
                    {% endif %}
{#					<span>关注的猎头</span>#}
					<div class="slider wdgz_silder"></div>
				</dt>
				<dd class="wdgz_search_box">
                    <input type="hidden" id="oldGroupInfoId" />
                    <input type="hidden" id="pu_id" value="{{ pu.id }}" />
{#					<form action="wdgz" method="post" >#}
{#                        {% csrf_token %}#}
                        <input type="hidden" id="hiddenValue" value="{{ condition }}" />
						<input  type="text" name="condition" class="search_txt ss_input" id="condition" onkeydown="queryData()" value="{{ condition }}">
						<input  type="button" name="" value="搜索" class="search_submit ss_anniu" onclick="queryBycondition()">
{#                    </form>#}
					<div class="wdgz_ckbox">
						<input type="checkbox" class="wdgz_ckall">
						<span>全选</span>
						<input type="button"  value="取消关注" class="wdgz_txt1" data-toggle="modal" data-target="#delete_gz_Modal" onclick="judgeSelected(this)">
						<input type="button"  value="分组"class="wdgz_txt1" data-toggle="modal" data-target="#update_fz_Modal" onclick="judgeSelected(this)"></div>
					<ul class="wdgz_info_list clearfix load" id="tableInfo">

					</ul>
				</dd>
				<dd>
					<div class="lthy_pager" id="paginInfo">

					</div>
				</dd>
				<div class="left_top_border"></div>
			</dl>
			<!-- 修改个人信息 -->
			<!-- 侧边栏 -->
			<div class="grxx_sidebar f_r">
				<div class="add_cal_btn">
					<i class="iconfont icon-tianjia"></i>
					添加新个人分组
				</div>
				<div class="grxx_sidebar_b" style="padding:20px 0;">
					<dl>
						<dt class="my_cal_title" style="margin-left:20px;margin-bottom: 5px;">关注的个人分组</dt>
						<dd class="cal_tree_dd" >
                        {% if groups %}
                                {% for group in groups %}
                                    <div class="panel-heading clearfix" style="padding:10px 20px 6px 20px;cursor: pointer;height:41px">
                                        <input type="hidden" value="{{ group.id }}" />
                                        <i class="iconfont icon-fangxiang2 f_l" style="font-size:16px"></i>
                                        <span class="f_l name_span ml5 fz16" onclick="queryByGroupId({{ group.id }})">{{ group.group_name }}</span>
                                        <input type="text" id="" value="{{ group.group_name }}" class="edit_name_input" maxlength="8" style="display: none;float:left">
                                        <span class="f_r num_group">{{ group.childCount }}</span>
                                        {% if group.group_name != '未分组' %}
                                            <span class="f_r add_up_re_btn">
                                                <i class="iconfont icon-xiugaichujia"></i>
                                               <i class="iconfont icon-shanchu fz18"></i>
                                            </span>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            {% endif %}

							<!-- <div class="panel-group wdgz_conter mt10" id="accordion">
                                {% if groups %}
                                    {% for group in groups %}
                                        <div class="panel panel-default">
                                            <div class="panel-heading clearfix" style="padding:10px 20px 6px 20px">
                                                <input type="hidden" value="{{ group.id }}" />
                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapse{{ forloop.counter }}" class="collapsed">
                                                    <i class="iconfont icon-jinlingyingcaiwangtubiao12 f_l fz14" style="margin-right:5px;transform: rotate(-90deg);"></i>
                                                    <span class="f_l name_span" {% if group.group_name == "未分组" %} onclick="queryByGroupId({{ group.id }})"{% endif %} >{{ group.group_name }}</span>
                                                    <input type="text" id="" value="{{ group.group_name }}"  class="edit_name_input" style="display: none;"/>

                                                    {% if group.group_name != "未分组" %}
                                                        <span class="f_r num_group">{{ group.count }}/{{ group.childCount }}</span>
                                                        <span class="f_r add_up_re_btn" style="display: none;">
                                                            <i class="iconfont icon-xiugaichujia"></i>
                                                            <i class="iconfont icon-tianjia"></i>
                                                            <i class="iconfont icon-shanchu"></i>
                                                        </span>
                                                    {% else %}
                                                        <span class="f_r num_group">{{ group.count }}</span>
                                                    {% endif %}
                                                </a>
                                            </div>
                                            <div id="collapse{{ forloop.counter }}" class="panel-collapse collapse" style="height:auto">
                                                <div class="panel-body" style="padding:0 0 8px 0">
                                                    <ul class="cal_tree_ul wdgz_cal_tree_ul"  style="padding-left:0px">
                                                        {% if group.childs %}
                                                            {% for child in group.childs %}
                                                                <input type="hidden" value="{{ child.id }}" />
                                                                <li>
                                                                    <span class="name_span" onclick="queryByGroupId({{ child.id }})" >{{ child.group_name }}</span><input type="text" id="" value="{{ child.group_name }}"  class="edit_name_input" style="display: none;"/>
                                                                    <span class="f_r num_group mt6">{{ child.count }}</span>
                                                                    <span class="f_r add_up_re_btn" style="display:none">
                                                                        <i class="iconfont icon-xiugaichujia"></i>
                                                                        <i class="iconfont icon-shanchu"></i>
                                                                    </span>
                                                                </li>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                {% endif %}
							</div> -->
						</dd>
					</dl>
				</div>
			</div>
			<!-- 侧边栏 -->
		</div>
	</div>
	<!-- 内容大框 -->
	<!-- 底部 -->
    {% include 'jobs/system/new_footer.html' %}
	<!-- 底部 -->
	<!-- 模态框（Modal） -->
	<div class="modal fade" id="delete_gz_Modal" tabindex="-1" role="dialog" 
        aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog"  style="width:300px">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="myModalLabel">取消关注</h4>
				</div>
				<div class="modal-body t_c">是否确认取消该名片</div>
				<div class="modal-footer ta-c">
                    <input type="hidden" id="cancelId" />
                    <input type="hidden" id="cancelGroupId" />
                    <button type="button" class="btn btn-primary m-l49" data-dismiss="modal" onclick="cancelAttention()">确认</button>
					<button type="button" class="btn-qx m-l5" data-dismiss="modal" style="width:auto;height:auto">取消</button>
					
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
	</div>
		<!-- /.modal -->
		<!-- 模态框（Modal） -->
	<!-- 模态框（Modal） --> 
	<div class="modal fade" id="update_fz_Modal" tabindex="-1" role="dialog" 
        aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog" style="width:300px">
			<div class="modal-content" >
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="myModalLabel">分组</h4>
				</div>
				<div class="modal-body t_c">
                    <select name="" id="groupList" style="width:270px;height: 30px;">
                    {% if groups %}
                        {% for secondGroup in groups %}
                            <option value="{{ secondGroup.id }}">{{ secondGroup.group_name }}</option>
                        {% endfor %}
                    {% endif %}
                    </select>
                </div>
				<div class="modal-footer">
                    <input type="hidden" id="operateState" />
					<button type="button" class="btn btn-primary"data-dismiss="modal" style="background:#5c91d9;" onclick="updateGroup()">完成</button>
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
	</div>
		<!-- /.modal -->
		<!-- 模态框（Modal） -->
		<div class="modal fade" id="update_bz" tabindex="-1" role="dialog"
        aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close"
               data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title" id="myModalLabel">添加备注</h4>
					</div>
					<div class="modal-body" style="margin-bottom: -10px;">
                        <input type="hidden" id="operateIndex" />
						<textarea name="" id="remark"></textarea>                        
                        <span style="text-align: right;color: #f66;display: block;padding-right: 7px;">(<i>1</i>/50)</span>
					</div>
					<div class="modal-footer">						
						<button type="button" class="btn btn-primary" onclick="updateRemark()" data-dismiss="modal">提交更改</button>
                        <button type="button" class="btn-qx" data-dismiss="modal">关闭</button>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
		</div>
		<!-- /.modal -->
    <script src="{{ STATIC_URL }}js/common.js" ></script>
    <script type="text/javascript">
        var pu_id = $('#pu_id').val();
        var sql = 'pu_id=' + pu_id + ' and attention_type=1';
        var querySql = sql;
        var loadData;
        var file_website = $('#file_website').val();
        $(function(){
            loadData = new pagin("paginInfo", "V_Attention_Info", "", sql, "", 6, "paginBind", "loadData");
        })
        //动态加载页面绑定数据
        function paginBind(dataInfo){
            if(dataInfo[0]==null){
                $("#tableInfo").removeClass('load');
                $("#tableInfo").empty(); 
                var content='<p class="no-mes">暂无记录</p>';
                $("#tableInfo").append(content);
                $("#paginInfo").css("display","none");
                return;
            }
            $("#tableInfo").empty();
            $(dataInfo).each(function(i){
                // 处理值为 null 的字段
                var len = $(this).length;
                var array = $(this);
                for(var n = 0; n < len; n ++){
                    if(array[n] == null){
                        array[n] = "&nbsp;"
                    }
                }
                $('#tableInfo').append('<li></li>');
                var labels = array[8];
                var labelStr = '';
                if(labels && labels != ''){
                    var labellist = new Array();
                    labellist = labels.split('**', 4);
                    for(var m = 0;m < labellist.length;m++){
                        labelStr += '<input type="button" value="'+labellist[m]+'">';
                    }
                }
                //获得关注的人信息（个人与猎头不一样）
                var title = '';
                var company = '';
                var position = '';
                var business = '';
                var location = '';
                var account_type = '';
                var objId = '';
                var user_name = '';
                var sex = '';
                $.ajax({
                    type: 'POST',
                    async: false,
                    url: "/ajax_getInfoByAttentionId",
                    data: {"attentionPuId": array[3]},
                    dataType: "json",
                    success: function(data){
                        objId = data.id;
                        account_type = data.account_type;
                        user_name = data.user_name;
                        sex = data.sex;
                        if(data.company != undefined && data.company != ''){
                            company = data.company;
                        }
                        if(data.account_type == 1){
                            position = data.position;
                        }else if(data.account_type == 3 || data.account_type == 5){
                            if(data.title && data.title != ''){
                                title = ' 【' + data.title + '】 ';
                            }
                            if(data.location != undefined && data.location != ''){
                                location = data.location;
                            }
                            if(data.business != undefined && data.business != ''){
                                business = data.business;
                            }
                        }
                    }
                });

                var obj = $('#tableInfo').children('li:last');
                var str = '';
                str += '<a href="javascript:void(0);" target="_blank" onclick="viewInformation(\''+account_type+'\', \''+objId+'\')">';
                str += '    <img src="'+ file_website+array[7]+'" style="width:88px;height:88px;margin-left:10px;position: relative;" alt=""  class="f_l"  onerror="notfind(this, \''+account_type+'\', \''+sex+'\')"></a>';
                str += '<dl class="f_l gzlt_dl" onclick="viewInformation(\''+account_type+'\', \''+objId+'\')">';
                str += '    <dt class="f_bold fz16 nowrap" style=\"width:200px\" title="'+user_name + '">'+user_name + '</dt>';
                str += '    <dd class="c_c8">'+company+'&nbsp;</dd>';
                str += '    <dd>'+position+ location + '</dd>';
                str += '</dl>';
                str += '<div class="clearfix"></div>';
                str += '<p class="ml15 fz12" style="margin-left: 10px">'+business+'</p>';
                str += '<div class="ww nowrap" style="width:310px;margin-left: 5px;height: 27px;">'+labelStr+'</div>';
                str += '<div class="wdgz_info_b"><input type="hidden" value="'+array[3]+'" /><input type="hidden" value="'+array[10]+'" />';
                str += '    <input type="checkbox" name="" value="" id="checkboxThreeInput'+(i + 1)+'"  class="check_b" style="border:0;padding:0">';
                //<label for="checkboxThreeInput'+(i + 1)+'"></label>
                str += '    <input type="button" value="取消关注" class="bd_raduio ml60 input_qx" data-toggle="modal" data-target="#delete_gz_Modal" onclick="getOperateData(this, '+(i + 1)+')">';
                str += '    <input type="button" value="修改分组"class="bd_raduio input_xg" data-toggle="modal"   data-target="#update_fz_Modal" onclick="getOperateData(this, '+(i + 1)+')">';
                str += '    <input type="button" value="私信" class="bd_raduio input_sx" data-toggle="modal" data-target="#sxmessage_Modal" onclick="getOperateData(this, '+(i + 1)+')">';
                str += '</div>';
                str += '<input type="hidden" value="'+array[11]+'" />';//分组ID（gid）
                str += '<div class="wdgz_layer"><div class="wdgz_layer_r"><div style="text-align: right;margin-top:0;padding-top:0"><span class="wdgz_edit"><i class="iconfont icon-xiugaiziliao"></i>备注</span></div><p class="bz">'+array[4]+'</p><textarea value="1253"  rows="4" class="edit_bz" maxlength="60" onblur="saveRemark(this, '+array[0]+')">'+array[4]+'</textarea></div><div class="wdgz_layer_b"><div class="wdgz_layer_b_l f_l">'+user_name+'</div><div class="wdgz_layer_b_r f_r" title="最后登录时间'+array[9]+'">最后登录时间：'+array[9]+'</div></div></div>';
                //str += '<dl class="wdgz_detail" style="display:none" >';
                //str += '    <dd class="f_l t_c">';
                //str += '        <a href="#"><img src="'+array[7]+'" style="width:88px;height:88px;" alt="" onerror="notfind(this,  \''+account_type+'\')"></a>';
                //str += '        <p>'+array[6]+'</p>';
                //str += '    </dd>';
                //str += '    <dd class="f_l wdgz_detail_r">';
                //str += '        <p>'+array[4]+'</p><input type="hidden" value="'+array[0]+'" name="remarkId" />';
                //str += '        <p class="c_8f">最后登录时间：'+array[9]+'</p>';
                //str += '    </dd>';
                //str += '    <dd class="update_btn" data-toggle="modal" data-target="#update_bz"><i class="iconfont icon-xiugaichujia"></i></dd>';
                //str += '</dl>';

                obj.append(str);

                 $(".wdgz_info_list li").mouseenter(function(){
                    $(this).children('.wdgz_detail').stop().slideDown(300);
                })
                $(".wdgz_info_list li").mouseleave(function(){
                    $(this).stop().children('.wdgz_detail').stop().slideUp(300);
                })
                //点击修改备注图标
                $('.update_btn').click(function(){
{#                    alert($(this).prev().children('p:first').text());#}
                    var index = $('.update_btn').index($(this));
                    $('#operateIndex').val(index);
                    if($(this).parent().prev().prev().children('.input_qx').val() == '取消关注'){
                        $('#remark').val($(this).prev().children('p:first').text());
                        $(this).attr('data-target', '#update_bz');
                    }else{
                        $(this).attr('data-target', '');
                        window.alert("你还没关注此人，不能填写备注！",4);
                    }
                })
               // $(".check_b").click(function(){
               //     if($(this).is(":checked")){
               //         $(this).next().css('backgroundImage', 'url(/static/images/ck_03.png)');
               //     }else{
               //         $(this).next().css('backgroundImage', 'url(/static/images/ck_05.png)');
               //     }
               // })
                  $("#tableInfo").removeClass('load');
{#                $("#tableInfo").append("<span>"+ $(this)[3] +"</span>  <span>"+ $(this)[4] +"</span><br />");#}
            });
        }
        function queryData(){
            if(event.keyCode == 13){
                queryBycondition();
            }
        }
        //根据条件查询数据（搜索功能）
        function queryBycondition(){
            var condition = $('#condition').val();
            querySql = sql + ' and user_name like "%' + condition + '%"';
            loadData = new pagin("paginInfo", "V_Attention_Info", "", encodeURI(querySql), "", 6, "paginBind", "loadData");
        }
        //点击添加新个人分组事件处理
        $(".add_cal_btn").click(function(){
            var length = $('.cal_tree_dd').children('div').length;
            if(length > 9){
                window.alert('最多添加10个分组',4);
                return;
            }
            var groupName = '默认分组';
            if(judgeExist(groupName, 0)){
                window.alert('已有默认分组，请先修改默认分组名称',4);
                return;
            }
            var groupType = '1';
            var parentId = 0;
            var operateType = 'add';
            $.ajax({
                type: "POST",
                url: "/ajax_groupOperate",
                data: {"parentId": parentId, "groupName": groupName, "groupType": groupType, "operateType": operateType},
                dataType: "json",
                success: function(data){
{#                    var number = $('#accordion').children().length + 1;#}
                    if(data.msg == "新建分组成功！"){
                        var str = '';
                        str += '<div class="panel-heading clearfix" style="padding:10px 20px 6px 20px;cursor: pointer;">';
                        str += '    <input type="hidden" value="' + data.id + '" />';
                        str += '    <i class="iconfont icon-fangxiang2 f_l" style="font-size:16px"></i>';
                        str += '    <span class="f_l name_span ml5 fz16" onclick="queryByGroupId(' + data.id + ')">默认分组</span>';
                        str += '    <input type="text" id="" value="默认分组" class="edit_name_input" maxlength="8" style="display: none;float:left">';
                        str += '    <span class="f_r num_group">0</span>';
                        str += '    <span class="f_r add_up_re_btn">';
                        str += '        <i class="iconfont icon-xiugaichujia"></i>';
                        str += '        <i class="iconfont icon-shanchu fz18"></i>';
                        str += '    </span>';
                        str += '</div>';

                        $(".cal_tree_dd").append(str);
                        $('#groupList').append('<option value="'+data.id+'">默认分组</option>');
                        //最后添加的分组呈修改状态
                        $(".cal_tree_dd").children('div:last').find('.icon-xiugaichujia').click();
                    }else{
                        window.alert(data.msg,4);
                    }
                }
            })

        })
        $(".wdgz_info_list li").mouseenter(function(){
            $(this).children('.wdgz_detail').stop().slideDown(300);
        })
        $(".wdgz_info_list li").mouseleave(function(){
            $(this).stop().children('.wdgz_detail').stop().slideUp(300);
        })
        $(".check_b").click(function(){
            if($(this).is(":checked")){
            $(this).next().css('backgroundImage', 'url(/static/images/ck_03.png)');}
            else{
            $(this).next().css('backgroundImage', 'url(/static/images/ck_05.png)');}
        })
        // $(document).on('mouseover','.panel-heading',function(){
        //     $(".panel-heading").removeClass('active');
        //     $(".wdgz_cal_tree_ul li").removeClass('active');
        //     $(this).addClass('active');
        // })
        // $(document).on('mouseout','.panel-heading',function(){
        //     $(".panel-heading").removeClass('active');
        //     $(".wdgz_cal_tree_ul li").removeClass('active');
        // })
        // $(document).on('mouseover','.wdgz_cal_tree_ul li',function(){

        //     $(".panel-heading").removeClass('active');
        //     $(".wdgz_cal_tree_ul li").removeClass('active');
        //     $(this).addClass('active');
        // })
        // $(document).on('mouseout','.cal_tree_dd #accordion',function(){

        //     $(".panel-heading").removeClass('active');
        //     $(".wdgz_cal_tree_ul li").removeClass('active');
        // })
        $(document).on('click', '.panel-heading', function(event) {
            event.preventDefault();
            $(".panel-heading").removeClass('active');
            $(this).addClass('active');
        });

        $("#add_btn").click(function(){
            $(".cyqy_table input[type=text]").val("");
        })
        //======= 信息模版
        $(".icon-iconfontmoban2").click(function(){
       	 $(".dialog").show();
	    })
	    $(".qx_btn").click(function(){
	         $(".dialog").hide();
	    })
	    $("#add_btn").click(function(){
	        $(".cyqy_table input[type=text]").val("");
	    })
	    $(".dialog li").click(function(){
	        $(".dialog li").removeClass('active');
	        $(this).addClass('active');
	    })
	    $(".dialog li").dblclick(function(){
	         confirms.call(this);
	    })
	    $(".modal_wdgz .re_btn").click(function(){
	        confirms.call(this);
	    })
	    function confirms(){
	        $("#letterContent").val($(".dialog li.active").children('input').val());
	        $(this).parent().parent().hide();
	    }
	     //========end 信息模版
        //修改分组名称
        $(document).on('click','.icon-xiugaichujia',function(){
            var oldValue = $(this).parent().prev().prev().val();
            var _this=this;
            $(this).parent().prevAll('.name_span').css('display','none');
            $(this).parent().prevAll('.edit_name_input').css('display','inline-block');
            $(this).parent().prevAll('.edit_name_input').focus();
            $(this).parent().prevAll('.edit_name_input').blur(function(){
                var obj = this;
                if($(this).val() == ''){
                    window.alert('请输入分组名称',4);
                    this.focus();
                    return ;
                }
                if(judgeExist($(this).val(), $('.edit_name_input').index(this)) == true){
                    window.alert('该分组名称已存在，请重新输入',4);
                    $(this).val('');
                    this.focus();
                    return ;
                }
                //判断分组名称有没改变
                var newValue = $(this).val();
                if(oldValue != newValue){
                    var groupId = $(this).parent().children('input:first').val();
                    var operateType = 'update';
                    //修改分组名称
                    $.ajax({
                        type: "POST",
                        url: "/ajax_groupOperate",
                        data: {"groupId": groupId, "groupName": newValue, "operateType": operateType},
                        dataType: "json",
                        success: function (data) {
                            if (data.msg == "修改分组成功！") {
                                $(_this).parent().prevAll('.name_span').html($(obj).val());
                                $(_this).parent().prevAll('.name_span').css('display','inline-block');
                                $(_this).parent().prevAll('.edit_name_input').css('display','none');

                                $('#groupList').children('option[value='+groupId+']').text($(obj).val());
                            } else {
                                window.alert(data.msg,4);
                            }
                        }
                    })
                }else{
                    $(_this).parent().prevAll('.name_span').css('display','inline-block');
                    $(_this).parent().prevAll('.edit_name_input').css('display','none');
                }
            })
        })
        //判断修改的分组名称是否重复
        function judgeExist(name, index){
            var groupSpans = $('.edit_name_input').prev('span');
            for(var m = 0;m < groupSpans.length;m++){
                if(m != index && groupSpans.eq(m).text() == name){
                    return true;
                }
            }
            return false;
        }
        //删除分组
        $(document).on('click','.icon-shanchu',function(){
            if(confirm("你确定要删除该分组吗？")){
                var _this = this;
                var groupId = $(this).parent().parent().children('input:first').val();
                var operateType = 'delete';
                $.ajax({
                    type: "POST",
                    url: "/ajax_groupOperate",
                    data: {"groupId": groupId, "operateType": operateType},
                    dataType: "json",
                    success: function (data) {
                        if(data.msg == "删除分组成功！") {
                            //把属于该分组的数据移到未分组中
                            var childCount = $(_this).parent().prev().text();
                            if(parseInt(childCount) > 0){
                                var liList = $('#tableInfo').children('li').children('input[value="'+groupId+'"]');
                                //设置未分组下的数量
                                var noGroupId = '';
                                $(".ml5").each(function(){
                                    if($(this).text() == "未分组"){
                                        var noGroup = $(this);
                                        noGroupId = noGroup.prev().prev().val();
                                        var own = noGroup.next().next().text();
                                        noGroup.next().next().text(parseInt(own) + parseInt(childCount));
                                    }
                                });
                                for(var m = 0;m < liList.length;m++){
                                    liList.eq(m).val(noGroupId)
                                }
                            }
{#                            for()#}
{#                            if($(_this).parent().parent().attr('data-toggle')) {#}

{#                                $(_this).parent().parent().parent().parent().remove();#}
{#                            }else{#}
                                //修改一级分类含有子分类数量
{#                                var countObj = $(_this).parent().parent().parent().parent().parent().prev().children('a').children('span').eq(1)#}
{#                                var countStr = countObj.text();#}
{#                                var oldCount = countStr.split('/')[1];#}
{#                                var newCountStr = countStr.split('/')[0] + '/' + (parseInt(oldCount) - 1);#}
{#                                countObj.text(newCountStr);#}
                            $('#groupList').children('option[value='+groupId+']').remove();
                            $(_this).parent().parent().remove();
{#                            }#}
                        }else{
                            window.alert(data.msg,4);
                        }
                    }
                })
            }
        })
        $(".message_Modal_box label").click(function(){
            $(this).parent().remove()
        })
        //修改备注
        function updateRemark(){
            var operateIndex = $('#operateIndex').val();
            if($('#remark').val() == ''){
                window.alert('请先填写备注再修改！',4);
            }else{
                var relationId = $("input[name='remarkId']").eq(operateIndex);
                var id = relationId.val();
                var remark = $('#remark').val();
                $.ajax({
                    type: "POST",
                    url: "/ajax_updateAttentionRemark",
                    data: {"remark": remark, "remarkId": id},
                    dataType: "json",
                    success: function(data){
                        if(data.msg == '修改成功！'){
                            relationId.prev().text(remark);
                        }else{
                            window.alert(data.msg,4);
                        }
                    }
                });
            }
        }
        //获得操作的数据
        function getOperateData(obj, index){
            $('#operateIndex').val(index);
            $('#cancelId').val($(obj).parent().children().eq(0).val());//被关注人的ID
            $('#cancelGroupId').val($(obj).parent().children().eq(1).val())//被关注人的分组关系ID
            $('#operateState').val('simple');
            if($(obj).val() == '修改分组'){
                //修改分组时，要显示该被关注人属于的分组，所有需要获得分组的ID
                var relationGroupId = $(obj).parent().children().eq(1).val();
                $.ajax({
                    type: "POST",
                    url: "/ajax_getGidByGinfoId",
                    data: {"relationGroupId": relationGroupId},
                    dataType: "json",
                    success: function (data) {
                        if (data.msg == 'success') {
                            $('#groupList').val(data.gid);
                            $('#oldGroupInfoId').val(data.gid);
                        } else {
                            window.alert(data.msg,4);
                        }
                    }
                });
            }else if($(obj).val() == '私信'){
{#                $('.message_Modal_box').children().remove();#}
                var username = $(obj).parent().parent().children('dl:eq(0)').children('dt:eq(0)').text();
{#                var em = '<span>' + username + '<label>x</label></span>';#}
{#                $('.message_Modal_box').append(em);#}
{#                $(".message_Modal_box label").click(function(){#}
{#                    $(this).parent().remove()#}
{#                })#}
                getOperateDatass(this, username, $(obj).parent().children().eq(0).val());
            }
        }
        //取消关注事件处理
        function cancelAttention() {
            //判断是单个取消关注还是多选的取消关注
            if($('#operateState').val() == 'simple'){
                var index = $('#operateIndex').val();
                var obj = $('#checkboxThreeInput' + index);
                var id = $('#cancelId').val();
                var groupId = $('#cancelGroupId').val();
                $.ajax({
                    type: "POST",
                    url: "/ajax_attentionOperate",
                    data: {"id": id, "type": "0", "groupId": groupId, "attentionType": 1},
                    dataType: "json",
                    success: function (data) {
                        if (data.msg == '取消关注成功！') {
                            obj.parent().parent().remove();
                            //修改分组含有的数量
                            var gid = obj.parent().next().val();
                            var group = $('input[value="'+gid+'"]').parent().find('.num_group:first');
                            var childCount = group.text();
                            group.text(parseInt(childCount) - 1);
                            //end
                            loadData = new pagin("paginInfo", "V_Attention_Info", "", querySql, "", 6, "paginBind", "loadData");
                            window.alert('取消关注成功',1);
                        } else {
                            window.alert(data.msg,4);
                        }
                    }
                });
            }else{
                allCancel();
            }
        }
        //修改我的关注个人所属分组
        function updateGroup(){
            //判断是单个修改分组还是多选的修改分组
            var newGroupId = $('#groupList').val();//修改后的分组ID
            if($('#operateState').val() == 'simple'){
                var oldGroupId = $('#oldGroupInfoId').val();//原分组ID
                var attentionId = $('#cancelId').val();//被关注人的ID
                $.ajax({
                    type: "POST",
                    url: "/ajax_updateGroup",
                    data: {"oldGroupId": oldGroupId, "newGroupId": newGroupId, "attentionId": attentionId},
                    dataType: "json",
                    success: function(data){
                        if(data.msg == "修改成功"){
                            //修改所属分组ID
                            var operaterIndex = parseInt($('#operateIndex').val()) - 1;
                            $('#tableInfo').children('li').eq(operaterIndex).children('input[type="hidden"]:last').val(newGroupId);

                            var oldObj = $('input[value="'+oldGroupId+'"]').parent().find('.num_group:first');
                            var newObj = $('input[value="'+newGroupId+'"]').parent().find('.num_group');
                            var oldCount = oldObj.text();
                            var newCount = newObj.text();
                            oldObj.text(parseInt(oldCount) - 1);
                            newObj.text(parseInt(newCount) + 1);
                            window.alert('修改成功',1);
                        }else{
                            window.alert(data.msg,4)
                        }
                    }
                });
            }else{
                updateSelectGroup(newGroupId);
            }
        }

        //根据分组ID获得分组下关注的人
        function queryByGroupId(groupId){

            querySql = sql + ' and gid=' + groupId;
            loadData = new pagin("paginInfo", "V_Attention_Info", "", querySql, "", 6, "paginBind", "loadData");
{#            window.location = 'wdgz?groupId=' + groupId + '&index=' + index;#}
        }
        //全选事件
        $('.wdgz_ckall').click(function(){
            var checkboxes = $(".wdgz_info_list input[type='checkbox']");
            if($(this).is(":checked")){
                for(var i= 0;i<checkboxes.length;i++){
                    checkboxes[i].checked=true;
                }
                $(".check_b").next().css('backgroundImage', 'url(/static/images/ck_03.png)');
            }else{
                for(var i= 0;i<checkboxes.length;i++){
                    checkboxes[i].checked=false;
                }
                $(".check_b").next().css('backgroundImage', 'url(/static/images/ck_05.png)');
            }
        })
        //取消关注选中的人
        function allCancel(){
            var checkboxes = $(".wdgz_info_list input[type='checkbox']:checked");
            if(checkboxes.length == 0){
                window.alert("请选择要取消关注的人！",4);
                return;
            }
            var attentionIds = [];//被关注人ID
            var groupIds = [];//分组ID
            for(var i = 0;i < checkboxes.length;i++){
                attentionIds.push(checkboxes.eq(i).prev().prev().val());
                groupIds.push(checkboxes.eq(i).prev().val());
            }
            $.ajax({
                type: "POST",
                url: "/ajax_cancelSelect",
                data: {"attentionIds": attentionIds, "type": "0", "groupIds": groupIds, "attentionType": 1},
                dataType: "json",
                success: function (data) {
                    if (data.msg == 'success') {
                        for(var i = 0;i < checkboxes.length;i++){
                            checkboxes.eq(i).parent().parent().remove();
                            //修改分组含有的数量
                            var gid = checkboxes.eq(i).parent().next().val();
                            var group = $('input[value="'+gid+'"]').parent().find('.num_group:first');
                            var childCount = group.text();
                            group.text(parseInt(childCount) - 1);
                            //end
                        }
                        loadData = new pagin("paginInfo", "V_Attention_Info", "", querySql, "", 6, "paginBind", "loadData");
                        window.alert('批量取消关注成功',1);
                    } else {
                        window.alert(data.msg,2);
                    }
                }
            })
        }
        //判断是否有选中的人
        function judgeSelected(obj){
            var checkboxes = $(".wdgz_info_list input[type='checkbox']:checked");
            if(checkboxes.length == 0){
                window.alert("请选择要操作的数据！",4);
                $('.wdgz_txt1').attr('data-target', '');
            }else{
                $('.wdgz_txt1:first').attr('data-target', '#delete_gz_Modal');
                $('.wdgz_txt1:last').attr('data-target', '#update_fz_Modal');
            }
            $('#operateState').val('multi');
        }
        //修改选中人的分组
        function updateSelectGroup(newGroupId){
            var checkboxes = $(".wdgz_info_list input[type='checkbox']:checked");
            if(checkboxes.length == 0){
                window.alert("请选择要修改分组的人！",4);
                return;
            }
            var groupIds = [];//分组ID
            for(var i = 0;i < checkboxes.length;i++){
                groupIds.push(checkboxes.eq(i).prev().val());
            }
            $.ajax({
                type: "POST",
                url: "/ajax_updateSelectGroup",
                data: {"groupIds": groupIds, "newGroupId": newGroupId},
                dataType: "json",
                success: function (data) {
                    if (data.msg != 'success') {
                        window.alert(data.msg,4);
                    }else{
                        for(var m = 0;m < checkboxes.length;m++){
                            var oldGid = checkboxes.eq(m).parent().next().val();
                            checkboxes.eq(m).parent().next().val(newGroupId);
                            var oldObj = $('input[value="'+oldGid+'"]').parent().find('.num_group:first');
                            var newObj = $('input[value="'+newGroupId+'"]').parent().find('.num_group');
                            var oldCount = oldObj.text();
                            var newCount = newObj.text();
                            oldObj.text(parseInt(oldCount) - 1);
                            newObj.text(parseInt(newCount) + 1);
                        }
                        loadData = new pagin("paginInfo", "V_Attention_Info", "", querySql, "", 6, "paginBind", "loadData");
                        window.alert('批量修改分组成功',1);
                    }
                }
            })
        }
        //
        function viewInformation(account_type, id){
            if(account_type == '1'){
                window.open('/resume/new_jlyl?resumeID=' + id, '_blank');
            }else{
                window.open('/system/ckjjrsy?puid=' + id, '_blank');
            }
        }
        $(document).on('click','.wdgz_edit',function(){
            $(this).parent().parent().children('.bz').hide().next('.edit_bz').show();
        })
       $(document).on('blur','.edit_bz',function(){                     
            $(this).prev().text($(this).val()).show();
            $(this).hide();
        })
    function saveRemark(obj, remark_id){
        var remark = $(obj).val();
        $.ajax({
            type: "POST",
            url: "/ajax_updateAttentionRemark",
            data: {"remark": remark, "remarkId": remark_id},
            dataType: "json",
            success: function(data){
                if(data.msg == '修改成功！'){

                }else{
                    window.alert(data.msg,4);
                }
            }
        });
    }
	</script>
</body>
	</html>