{% include 'jobs/system/header.html' %}
<link href="{{ STATIC_URL }}css/bootstrap.css" media="screen" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="{{ STATIC_URL }}css/css.css">
<link href="{{ STATIC_URL }}css/style.css" media="screen" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="{{ STATIC_URL }}css/single/jjrsy.css">
<script src="{{ STATIC_URL }}js/jquery.knob.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/pagination.js"></script>
<style type="text/css">
	.page_number li{padding: 0px 10px!important;height:auto!important;border-bottom-style:solid!important;margin-top: 30px;}
	.mid{padding-bottom:30px;}
	.grbq li{height:auto;}
	.content .main .mid .zb .fwpj .pjxq li .pjzp{overflow: hidden;}
	.content .main .mid .zb .fwpj .pjxq li .pjzp img{width:55px;height:55px;}
	 .fenxiang {
    display: none;
    margin-left: -40px;
    margin-top: 2px;
    border: 1px solid #e0e0e0;
    width: 105px;
    font-size: 12px;
    background-color: white;
    text-align: left;
    position:absolute;
    z-index: 999;
}
.auditResult2 {
    float: left;
    height: 45px;
    cursor: pointer;
    line-height: 45px;
    width: 90px;
    text-align: center;
}
.fenxiang .word {
    background-color: #f4f4f4;
    color: #333;
    cursor: default;
    padding: 0px 8px;
    height: 30px;
    line-height: 30px;
}
.fenxiang a {
    display: block!important;
    height: 45px;
    line-height: 45px;
    margin-left: 10px;
    text-indent: 20px;
    background-repeat: no-repeat;
    background-position: left center!important;
}

.content .main .mid .zb .fbdzw .fbzwjg li .f_l h2 span {
    color: #f80;
    margin-left: 10px;
}
.content .main .mid .zb .fbdzw .fbzwjg li {
    height: 0px;
    padding: 30px 15px;
    border-bottom: 1px dashed #e0e0e0;
}
#fenxiang_box:hover .fenxiang{display:block!important;color:red;}
.td{border:solid #add9c0; border-width:0px 1px 1px 0px; padding:10px 0px; text-align: center}
 .table{border:solid #add9c0; border-width:1px 0px 0px 1px;}
.searchAuditUl{
    float: right;
    margin-right: 30px;
}
.searchAuditUl li{
    float: left;
    padding-left: 10px;
}
.search_input {
    border: 2px solid #5c91d9;
    height: 36px;
    line-height: 36px;
    width: 200px;
    float: left;
    text-indent: 10px;
}
{
    height: 36px;
    line-height: 36px;
    float: left;
}
</style>
<div class="clear">99</div>
<div class="content ">
	<div class="main">
	<!-- 基本信息 -->
		<div class="jbxx">
			<div class="clearfix" style="height:70px;">
                <h1 style="font-size: 25px">管理员验证用户的信息审核页面</h1>
                <ul class="searchAuditUl">
                    <li><input type="text" placeholder="请输入用户名(TPU)表" name="user_name" class="search_input"/></li>
                    <li>
                        <input type="radio" value="1" name="type" style="width: 36px; height: 36px"><span class="auditSpan">个人认证</span>
                    </li>
                    <li>
                        <input type="radio" value="2" name="type" checked style="width: 36px;height: 36px"><span class="auditSpan">企业认证</span>
                    </li>
                    <li class="searchAuditButton"><input type="button" value="查  询"style="font-size: 16px;width:80px;height:30px;color:white;background-color: #5C91D9;display:block;border-radius: 5px;line-height: 30px;text-align: center;cursor: pointer"></li>
                </ul>
			</div>
		</div>
		<!-- 个人信息编辑 -->
		
		<!-- 中间导航部分开始 -->
		<div class="mid clearfix">
			<!-- 左边 -->	
			<div class="zb" style="    width: 100%;">
				<ul class="qh clearfix accountTypeUl">
					<li class="active publicPositionLi">人才经纪人验证信息</li>
					<li class="headhuntEvaluation">企业验证信息</li>
				</ul>
				<!-- 正在发布的职位内容 -->
				<div class="fbdzw">
				
					<ul class="sstj clearfix positionType">
					 	<h2>人才经纪人：</h2>
						<li class="showAuditType active" name="1">个人信息验证</li>
                        <li class="showAuditType" name="2" style="margin-left: 20px">企业信息验证</li>
					</ul>
                    <div class="f_l" display="none">
                        <p class="pjz">
                            <ul class="sstj">
                                <li class="auditResult1 active" name="0" style="float: left;">全部</li>
                                <li class="auditResult1" name="2" style="float: left; margin-left: 20px">待审核</li>
                                <li class="auditResult1" name="3" style="float: left; margin-left: 20px">审核已通过</li>
                                <li class="auditResult1" name="1">审核未通过</li>
                            </ul>
                        </p>
                    </div>
					<div class="fbzwjg" style="float: left" >
{#						<ul id="positionsPaginBody"></ul>#}
                        <table id="positionsPaginBody" class="table"></table>
                        <div class="lthy_pager" id="positionPaginInfo"></div>
					</div>
				</div>
				<!-- 服务评价内容 -->
				<div class="fwpj dis">
					<div class="pjxx clearfix">
						<div class="f_l">
                            <p class="pjz">
                                <h2 style="color: #5c91d9; font-size: 15px; margin-bottom: 15px">企业信息审核：</h2>
                                <ul class="sstj">
                                    <li class="auditResult2 active" name="0">全部</li>
                                    <li class="auditResult2" name="2">待审核</li>
                                    <li class="auditResult2" name="3">审核已通过</li>
                                    <li class="auditResult2" name="1">审核未通过</li>
                                </ul>
                            </p>
						</div>
                        <div class="fbzwjg" style="float: left">
{#                            <ul id="positionsPaginBody2"></ul>#}
                            <table id="positionsPaginBody2" class="table"></table>
                            <div class="lthy_pager" id="positionPaginInfo2"></div>
                        </div>
					</div>
				</div>
				<!-- 页码 page -->
			</div>
		</div>
	</div>
</div>
<input type="hidden" name="headhuntOrTpc" value="1">
<input type="hidden" name="auditResult">
<input type="hidden" name="pcType">
<input type="hidden" id="file_website" value="{{ request.session.file_website }}" />
<script  src="{{ STATIC_URL }}js/lib/ind/layer/layer.js" type="text/javascript"></script>
<script type="text/javascript">

    // 填写查询信息，并加入样式
    $(".showAuditType").click(function(){
        $(".showAuditType").removeClass("active");
        $(this).addClass("active");
        $(":hidden[name=headhuntOrTpc]").val($(this).attr("name"));

        // 根据条件查看认证信息
        showAuditResult();
    });
    // 填写查询信息，并加入样式
    $(".auditResult1").click(function(){
        $(".auditResult1").removeClass("active");
        $(this).addClass("active");
        $(":hidden[name=auditResult]").val($(this).attr("name"));
        // 根据条件查看认证信息
        showAuditResult();
    });
    // 填写查询信息，并加入样式
    $(".auditResult2").click(function(){
        $(".auditResult2").css("color", "");
        $(this).css("color", "#5c91d9");
        $(":hidden[name=auditResult]").val($(this).attr("name"));
        var sql = ' PC_Type=1';
        var auditResult = $(":hidden[name=auditResult]").val();
        if (auditResult == '1' || auditResult == '2' || auditResult == '3') {
            sql += ' and Audit_Result=' + auditResult;
        }
        sql += "  order by Auditor_Date desc";
        loadData = new pagin("positionPaginInfo2", "V_Pu_Audit", "", encodeURI(sql), "", 8, "tpcAuditList", "loadData");
    });

    // 最上方的选择用户类型d
    $(".accountTypeUl li").click(function(){
       $(".accountTypeUl li").removeClass("active");
        $(this).addClass("active");
        if($(this).hasClass("publicPositionLi")) {
            $(".fbdzw").removeClass("dis");
            $(".fwpj").addClass("dis");
        } else {
            $(".fbdzw").addClass("dis");
            $(".fwpj").removeClass("dis");
        }
    });
    var loadData;
    var file_website = '';
	$(function() {
        file_website = $('#file_website').val();
        $(".knob").knob({
            thickness: .1,
            fgColor: '#ff8800',
            bgColor: '#e4e4e4',
            displayInput: false,
            readOnly: true
        });
        // 查找猎头认证的信息
        $(".tpuheadhuntAuditSearch").click(function () {
            var headhuntOrTpc = $(":hidden[name=headhuntOrTpc]").val();
            var auditResult = $(":hidden[name=auditResult]").val();
            var sql = '1=1';
            if (headhuntOrTpc == '1' || headhuntOrTpc == '2') {
                sql += ' and Audit_Type =' + headhuntOrTpc;
            } else {
                alert("请选择个人信息还是企业认证!");
                return false;
            }
            if (auditResult == '1' || auditResult == '2' || auditResult == '3') {
                sql += ' and Audit_Result=' + auditResult;
            }
            if (headhuntOrTpc == '1') {
                sql += "  order by Auditor_Date desc";
                loadData = new pagin("positionPaginInfo", "V_Pu_Audit", "", encodeURI(sql), "", 8, "headhuntAuditList", "loadData");
            } else {
                sql += ' and PC_Type=2';
                sql += "  order by Auditor_Date desc";
                loadData = new pagin("positionPaginInfo2", "V_Pu_Audit", "", encodeURI(sql), "", 8, "tpcAuditList", "loadData");
            }

        });

    });
        ///  个人信息验证分页
        function headhuntAuditList(dataInfo) {
            $("#positionsPaginBody").empty();
            var content = '<tr>';
            content += '    <td class="td">用户名(TPU)</td>';
            content += '    <td class="td">真实姓名(验证)</td>';
            content += '    <td class="td">身份证号(验证)</td>';
            content += '    <td class="td">身份证照片(验证)</td>';
            content += '    <td class="td">头像(验证)</td>';
            content += '    <td class="td">审核时间</td>';
            content += '    <td class="td">审核状态</td>';
            content += '</tr>';

            $(dataInfo).each(function (i) {
                // 处理值为 null 的字段
                var len = $(this).length;
                var array = $(this);
                for (var n = 0; n < len; n++) {
                    if (array[n] == null) {
                        array[n] = "&nbsp;"
                    }
                }

                content += '<tr name="' + array[18] + '">';
                content += '    <td class="td">' + array[19] + '</td>';
                content += '    <td class="td">' + array[14] + '</td>';
                content += '    <td class="td">' + array[15] + '</td>';
                content += '    <td class="td"  onclick="openNewPageToSeeImage(\'' + array[16] + '\')"><img src="'+file_website + array[16] + '" style="width: 55px;height: 55px; cursor: pointer"></td>';
                content += '    <td class="td"  onclick="openNewPageToSeeImage(\'' + array[17] + '\')"><img src="'+file_website + array[17] + '" style="width: 55px;height: 55px; cursor: pointer"></td>';
                content += '    <td class="td">' + array[5] + '</td>';
                content += '    <td class="td" name="'+ array[0] +'">';
                content += '<select onchange="changeAuditStatus(this)" name="' + array[3] + '">';
                if(array[3] == 1) {
                    content += '    <option value="2">待审核</option>';
                    content += '    <option value="3">审核已通过</option>';
                    content += '    <option value="1" selected>审核未通过</option>';
                } else if(array[3] == 2) {
                    content += '    <option value="2" selected>待审核</option>';
                    content += '    <option value="3">审核已通过</option>';
                    content += '    <option value="1">审核未通过</option>';
                } else if(array[3] == 3) {
                    content += '    <option value="2">待审核</option>';
                    content += '    <option value="3" selected>审核已通过</option>';
                    content += '    <option value="1">审核未通过</option>';
                } else {
                    content += '    <option value="2">待审核</option>';
                    content += '    <option value="3">审核已通过</option>';
                    content += '    <option value="1">审核未通过</option>';
                }
                content += '</select>';
                content +=  '</td>';
                content += '</tr>';
            });
            $("#positionsPaginBody").append(content);
        }


    // 认证状态选择框改变事件
    function changeAuditStatus(obj) {
       var $this = $(obj);
        var oldValue = $this.attr("name");
       var beingPuId = $this.parent().parent().attr("name");
        var $auditStatusTd = $this.parent();
       var auditId = $auditStatusTd.attr("name");
       var newStatus = $this.val();
        var context = $this.find("option:selected").text();
        var flag = confirm("您确定要修改此用户状态为 " + context + " 吗?");
        if (!flag) {
{#            $this.find("option").removeAttr("selected");#}
            $this.find("option[value="+ oldValue + "]").attr("selected", true);
            return false;
        }
        $.ajax({
            type: 'post',
            data: {'auditId': auditId, 'newStatus': newStatus, 'beingPuId': beingPuId, 'oldStatus': oldValue},
            url: '/ajax_changeTPuAuditStatus',
            dataType: 'json',
            success: function(data) {
                if(data.status == '1') {
                    alert("修改成功!");
                    $this.attr("name", newStatus);
                } else {
                    alert("修改失败!");
                }
            }
        })
    }

        ///  企业信息验证分页
        function tpcAuditList(dataInfo) {
            var $tableBody;
            if($(".publicPositionLi").hasClass("active")) {
                $tableBody = $("#positionsPaginBody");
            } else {
                $tableBody = $("#positionsPaginBody2");
            }
            $tableBody.empty();
            var content = '<tr>';
            content += '    <td class="td">用户名(TPU)</td>';
            content += '    <td class="td">企业名称(验证)</td>';
            content += '    <td class="td">营业执照(验证)</td>';
            var Pc_Account_Type = dataInfo[0][21];
            if(Pc_Account_Type == 2 || Pc_Account_Type == 4) {
                content += '    <td class="td">手机号(验证)</td>';
            } else {
                content += '    <td class="td">企业座机(验证)</td>';
            }

            content += '    <td class="td">审核时间</td>';
            content += '    <td class="td">审核状态</td>';
            content += '</tr>';

            $(dataInfo).each(function (i) {
                // 处理值为 null 的字段
                var len = $(this).length;
                var array = $(this);
                for (var n = 0; n < len; n++) {
                    if (array[n] == null) {
                        array[n] = "&nbsp;"
                    }
                }
                content += '<tr name="' + array[11] + '">';
                content += '    <td class="td">' + array[12] + '</td>';
                content += '    <td class="td">' + array[7] + '</td>';
                content += '    <td class="td" onclick="openNewPageToSeeImage(\'' + array[8] + '\')"><img src="'+ file_website + array[8] + '" style="width: 55px;height: 55px;  cursor: pointer"></td>';
                // 企业用户显示电话
                if(Pc_Account_Type == 2 || Pc_Account_Type == 4) {
                    content += '    <td class="td">' + array[20] + '</td>';
                } else {
                    content += '    <td class="td">' + array[9] + '</td>';
                }

                content += '    <td class="td">' + array[5] + '</td>';
               content += '    <td class="td" name="'+ array[0] +'">';
                content += '<select onchange="changeAuditStatus(this)" name="' + array[3] + '">';
                if(array[3] == 1) {
                    content += '    <option value="2">待审核</option>';
                    content += '    <option value="3">审核已通过</option>';
                    content += '    <option value="1" selected>审核未通过</option>';
                } else if(array[3] == 2) {
                    content += '    <option value="2" selected>待审核</option>';
                    content += '    <option value="3">审核已通过</option>';
                    content += '    <option value="1">审核未通过</option>';
                } else if(array[3] == 3) {
                    content += '    <option value="2">待审核</option>';
                    content += '    <option value="3" selected>审核已通过</option>';
                    content += '    <option value="1">审核未通过</option>';
                } else {
                    content += '    <option value="2">待审核</option>';
                    content += '    <option value="3">审核已通过</option>';
                    content += '    <option value="1">审核未通过</option>';
                }
                content += '</select>';
                content +=  '</td>';
                content += '</tr>';
            });
            $tableBody.append(content);
        }

    // 根据名字查找认证信息
    $(".searchAuditButton").click(function(){
        var user_name = $(":input[name=user_name]").val();
        var type = $(":radio[name=type]:checked").val();
        if(type == '1') {
            var sql = ' Audit_Type=1 and Headhunt_User_Name like "%' + user_name + '%"';
            loadData = new pagin("positionPaginInfo", "V_Pu_Audit", "", encodeURI(sql), "", 8, "headhuntAuditList", "loadData");
        } else {
            var sql = ' Audit_Type=2 and Pc_User_Name like "%' + user_name + '%"';
            loadData = new pagin("positionPaginInfo2", "V_Pu_Audit", "", encodeURI(sql), "", 8, "tpcAuditList", "loadData");
        }
    })

    function showAuditResult(){
        var headhuntOrTpc = $(":hidden[name=headhuntOrTpc]").val();
        var auditResult = $(":hidden[name=auditResult]").val();
        var sql = '1=1';
        if (headhuntOrTpc == '1' || headhuntOrTpc == '2') {
            sql += ' and Audit_Type =' + headhuntOrTpc;
        } else {
            alert("请选择个人信息还是企业认证!");
            return false;
        }
        if (auditResult == '1' || auditResult == '2' || auditResult == '3') {
            sql += ' and Audit_Result=' + auditResult;
        }
        if (headhuntOrTpc == '1') {
            sql += "  order by Auditor_Date desc";
            loadData = new pagin("positionPaginInfo", "V_Pu_Audit", "", encodeURI(sql), "", 8, "headhuntAuditList", "loadData");
        } else {
            $(":input[name=pcType]").val(2);
            sql += ' and PC_Type=2';
            sql += "  order by Auditor_Date desc";
            loadData = new pagin("positionPaginInfo2", "V_Pu_Audit", "", encodeURI(sql), "", 8, "tpcAuditList", "loadData");
        }
    }

    function openNewPageToSeeImage(imagePath) {
        if(imagePath != ''){
            window.open(imagePath, '_blank');
        }
    }

// 自动加载全部
    $(".auditResult1[name=0]").click();
    $(".headhuntEvaluation").click(function(){
        $(":input[name=pcType]").val(1)
        // 自动加载全部
        $(".auditResult2[name=0]").click();
    })
</script>
{% include 'jobs/system/new_footer.html' %}