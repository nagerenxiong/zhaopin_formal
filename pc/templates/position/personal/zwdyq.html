{% include 'jobs/system/header.html' %}
<link href="{{ STATIC_URL }}css/bootstrap.css" media="screen" rel="stylesheet" type="text/css">
<link href="{{ STATIC_URL }}css/style.css" media="screen" rel="stylesheet" type="text/css">
<script type="text/javascript" src="{{ STATIC_URL }}js/businessul_old.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/position_old.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/area.js"></script>
<link href="{{ STATIC_URL }}css/style1.css" media="screen" rel="stylesheet" type="text/css">
<link href="{{ STATIC_URL }}css/style_cj.css" media="screen" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/reset.css">
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/basic.css">
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/pages.css">
<link rel="stylesheet" href="{{ STATIC_URL }}css/kongjian.css">
<style>
   .modal_box h3 em{
     width:103%; height:104%;
   }
 </style>
<script src="{{ STATIC_URL }}js/scroll.js" ></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/qiehuan.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/pagination.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/bootstrap.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/pagination.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/businessul.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/position.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/area.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/major.js"></script>
    
        {% include 'jobs/system/menu_tdjl.html' %}

    <div class="clear">2</div>
    <div class="clear">3</div>
    <div class="hl_main mt25">
        <div class="zwdy_main">
            <div class="content_l_t">
                <div class="clt_float"></div>
                <div class="content_l_t1">
                    <a href="#" class="ahover">职位订阅器</a>
                </div>
                <div class="clear"></div>
                <div class="clear">3</div>
            </div>
            <div class="ht40"></div>
           <div class="zwdyq_m">
                <h2 class="dyq_t"><a href="javascript:void(0);" onclick="resetOperateData()">添加职位订阅器</a><img src="{{ STATIC_URL }}images/dyq.png">当前有<span>{{ count }}</span>订阅器</h2>
                <ul class="zwdyq_gr_ul">
                    {% if listPostion %}
                        {% for position in listPostion %}
                            <li>
                                <h3><a href="javascript:void(0)" style="cursor: pointer;" onclick="getUpdateData({{ position.id }})">{{ position.subscriber_name }}</a><span class="">
                                {% if position.keywords  %}
                                【 {{ position.keywords }} 】
                                {% endif %}
                                </span></h3>
                                <p><a style="font-size:25px;line-height:12px" class="btn_sc ml15 iconfont icon-shanchu" href="javascript:void(0)" onclick="deleteSubscriber({{ position.id }})"></a>
                                    <a style="font-size:25px;line-height:12px" href="javascript:void(0)" onclick="getUpdateData({{ position.id }})" class="iconfont icon-xiugaiziliao fz20 f_r" style="color:#a9a8af;margin-right: 5px;cursor: pointer"></a>
                                    <a href="javascript:void(0)"><i class="iconfont icon-ditu"></i>{{ position.area }}</a>
{#                                    <a href="javascript:void(0)"><i class="icon-company iconfont"></i>{{ position.industry }}  |  {{ position.position }}</a>#}
                                    <a href="javascript:void(0)"><i class="icon-rmb iconfont"></i>{{ position.salary }}</a>
                                    <a href="javascript:void(0)"><i class="icon-duanxin iconfont"></i>{{ position.email }}</a>
                                    {% if position.add_date %}<a href="javascript:void(0)"><i class="icon-shizhong1 iconfont"></i>{{ position.add_date|date:"Y-m-j " }}</a>{% endif %}
                                </p>
                            </li>
                        {% endfor %}
                    {% endif %}
{#                    <li>#}
{#                        <h3>职位订阅器<span class="">【 设计  设计总监  设计指导 】</span></h3>#}
{#                        <p><a class="btn_sc" href="#"><img src="{{ STATIC_URL }}images/sc.png"></a><a href="#"><i class="iconfont icon-ditu"></i>江西省  |  南昌市</a><a href="#"><i class="icon-company iconfont"></i>计算机/互联网/通信/电子  |  UI设计</a><a href="#"><i class="icon-rmb iconfont"></i>15万-30万</a><a href="#"><i class="icon-duanxin iconfont"></i>ch6795252@126.com</a><a href="#"><i class="icon-shizhong1 iconfont"></i>2015-15-15</a></p>#}
{#                    </li>#}
{#                    <li>#}
{#                        <h3>职位订阅器<span class="">【 设计  设计总监  设计指导 】</span></h3>#}
{#                        <p><a class="btn_sc" href="#"><img src="{{ STATIC_URL }}images/sc.png"></a><a href="#"><i class="iconfont icon-ditu"></i>江西省  |  南昌市</a><a href="#"><i class="icon-company iconfont"></i>计算机/互联网/通信/电子  |  UI设计</a><a href="#"><i class="icon-rmb iconfont"></i>15万-30万</a><a href="#"><i class="icon-duanxin iconfont"></i>ch6795252@126.com</a><a href="#"><i class="icon-shizhong1 iconfont"></i>2015-15-15</a></p>#}
{#                    </li>#}
{#                    <li>#}
{#                        <h3>职位订阅器<span class="">【 设计  设计总监  设计指导 】</span></h3>#}
{#                        <p><a class="btn_sc" href="#"><img src="{{ STATIC_URL }}images/sc.png"></a><a href="#"><i class="iconfont icon-ditu"></i>江西省  |  南昌市</a><a href="#"><i class="icon-company iconfont"></i>计算机/互联网/通信/电子  |  UI设计</a><a href="#"><i class="icon-rmb iconfont"></i>15万-30万</a><a href="#"><i class="icon-duanxin iconfont"></i>ch6795252@126.com</a><a href="#"><i class="icon-shizhong1 iconfont"></i>2015-15-15</a></p>#}
{#                    </li>#}
                </ul>
            </div>
        <div class="ht30"></div>
        <div class="xzzwdyq" style="display:none">
            <h3>
                <span>新增职位订阅器</span>
            </h3>
            <div class="ht40"></div>
            <h4>
                <img src="{{ STATIC_URL }}images/wxts.png"   />
                温馨提示：设置职位订阅器，我们每周将会发送最新发布的职位到您的邮箱
            </h4>
            <div class="xzdyq_tb" >
                <div class="ht25" id="dw_zydyq"></div>
                <form action="/position/personal/zwdyq" method="post" id="add" onsubmit="return yzsubmit()">
                    {% csrf_token %}
                    <input type="hidden" name="subscriber_id" />
                    <div>
                        <span>订阅器名称</span>
                        <input type="text" name="subscriber_name" style="background: url(/static/images/bitian.png) no-repeat 0px 12px!important;" placeholder="请输入订阅器名称" onblur="yzPerson(this)" />
                        <span class="ml25" style="color:#ff6a6a"></span>
                    </div>
                    <div>
                        <span>行业分类</span>
{#                        <input type="text" onblur="yzModal(this)" name="industry_name" id="industry"  placeholder="当前行业"#}
{#                             onclick="showBusinessul(this,3)" >#}
                        <div id="businessulDiv" onclick="BusinessulControlsShow(3,this)"></div>
                        <input type="hidden" name="industry_type" id="expid"  />
                        <span class="ml25 " style="color:#ff6a6a" >                     
                        </span>
                    </div>
                     <div>
                        <span>职能分类</span>
{#                        <input type="text" name="major" id="major"  placeholder="请先选择所处职位" onclick="positionShow(this)"#}
{#                             onblur="yzModal(this)" >#}
                        <div id="positionDiv" onclick="PositionControlsShow(3,this)"></div>
                        <input type="hidden" name="postaion_type" id="majorid"  />
                        <span class="ml25 " style="color:#ff6a6a" ></span>
                    </div>
                     <div>
                        <span>工作地点</span>
                        <input type="text" onclick="showArea(this, 3)" onblur="yzModal(this)" name="workarea"   placeholder="工作地点" >
                        <input type="hidden" name="work_area"   />
                        <span class="ml25 " style="color:#ff6a6a" >                         
                        </span>
                    </div>
                     <div>
                        <span>年薪范围</span>
                        <select name="pay" id="salary"  onchange="yzPerson(this)">
                            <option value="">请选择</option>
                            {% if expecpayList %}
                                {% for expect in expecpayList %}
                                    <option value="{{ expect.dictionary_value }}">{{ expect.dictionary_name }}</option>
                                {% endfor %}
                            {% endif %}
                        </select>
                        <span class="ml25 " style="color:#ff6a6a" >                           
                        </span>
                    </div>
                    <div>
                        <span>关键字</span>
                        <input type="text" name="keywords" style="background:none!important;" placeholder="多个关键字直接用空格空开" id="keywords" onblur="yzPerson(this)" >
                        <span class="ml25"style="color:#ff6a6a" >
                        </span>
                    </div>
                    <div>
                        <span>接收邮箱</span>
                       <em>{{ pu.email }}</em>
                       <span class="ml25"style="color:#ff6a6a" ></span>
                    </div>
                </form>
                <div class="ht30"></div>
            </div>
            <div class="ht20"></div>
            <p class="xzdyq_btn">
                <a class="btn_qrdyq" href="javascript:void(0)" onclick="formsubmit()">确认订阅器</a>
                <a href="javascript:void(0);" onclick="viewSearch()">预览搜索效果</a>
            </p>
            <div class="ht30"></div>
        </div>       
    </div>
</div>

<!-------------------------------------- 内容结束 -------------------------------------->
<!-------------------------------------- 尾部开始 -------------------------------------->

{% include 'jobs/system/new_footer.html' %}
<!-------------------------------------- 尾部开始 -------------------------------------->

{#<div class="page_xf_r">#}
{#    <ul>#}
{#        <li>#}
{#            <a href="javascript:void(0)" title="返回顶部" onclick="backToTop()">#}
{#                <img src="{{ STATIC_URL }}images/xf_top.png" />#}
{#            </a>#}
{#            <div class="xf_r_dw">返回顶部</div>#}
{#        </li>#}
{#        <li>#}
{#            <a href="#">#}
{#                <img src="{{ STATIC_URL }}images/xf_bj.png" />#}
{#            </a>#}
{#        </li>#}
{#        <li>#}
{#            <a href="#">#}
{#                <img src="{{ STATIC_URL }}images/xf_zxkf.png" />#}
{#            </a>#}
{#        </li>#}
{#        <li>#}
{#            <a href="#">#}
{#                <img src="{{ STATIC_URL }}images/xf_phone.png" />#}
{#            </a>#}
{#        </li>#}
{#    </ul>#}
{#</div>#}

<div class="modal fade" id="delete_Modal" tabindex="-1" role="dialog"
   aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width: 433px;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close"
               data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">确认删除</h4>
            </div>
            <div class="modal-body t_c">是否确认删除</div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" style="width:auto;height:auto">否</button>
                <input type="hidden" id="del"  />
                <button type="button" class="btn btn-primary" data-dismiss="modal" style="width:auto;height:auto" onclick="Delzw()">是</button>
            </div>
        </div>
    </div>
    <!-- /.modal-content -->
</div>
<input type="hidden" id="recieveEmail" value="{{ pu.email }}" />
</body>
</html>
<script type="text/javascript">
    var recieveEmail = $('#recieveEmail').val();
    $(function(){
        if(recieveEmail == ''){
            window.alert('你还没绑定邮箱，请先绑定邮箱');
        }
        BusinessulControls("businessulDiv", '', '', 'width:250px;margin-top:5px;font-size:14px;');
        PositionControls("positionDiv", '', '', 'width:250px;margin-top:5px;font-size:14px;');
    })
    function positionShow(obj){
        showPosition(obj,$("#industry").val(),$("#expid").val(),3);
    }
    function yzPerson(obj){
        if($(obj).val()!="0"&&$(obj).val()!=""){
            $(obj).next().empty();
            // $(obj).next().append("<i class=\"iconfont icon-gou\">");
        }else{
            $(obj).next().empty();            
        }
    }
    function yzModal(obj){
        if($(obj).next().val()!=""&&$(obj).next().val()!=0){
            $(obj).next().next().empty();
            // $(obj).next().next().append("<i class=\"iconfont icon-gou\">");
        }else{
            $(obj).next().next().empty();          
        }
    }
    function formsubmit(){
        if(recieveEmail == ''){
            window.alert('你还没绑定邮箱，请先绑定邮箱');
            return;
        }
        if($('input[name="subscriber_name"]:eq(0)').val() == ''){
            window.alert('订阅器名称不能为空，请填写订阅器名称');
            return ;
        }
        //if($("#salary option:selected").attr('value') == ""){
        if($("#salary option:selected").text() == "请选择"){
            alert("年薪范围不能为空");
            return false;
        }
        $("#add").submit();
    }
    function yzsubmit(){
        if($("[name=industry_type]").val()==""||$("[name=industry_type]").val()==0){
            alert("请补全信息!");
            return false
        }
        if($("[name=postaion_type]").val()==""||$("[name=postaion_type]").val()==0){
            alert("请补全信息!");
            return false
        }
        if($("[name=work_area]").val()==""||$("[name=work_area]").val()==0){
            alert("请补全信息!");
            return false
        }
        if($("[name=work_year]").val()==""||$("[name=work_year]").val()==0){
            alert("请补全信息!");
            return false
        }
        if($("[name=diploma]").val()==""||$("[name=diploma]").val()==0){
            alert("请补全信息!");
            return false
        }
        if($("[name=work_nature]").val()==""||$("[name=work_nature]").val()==0){
            alert("请补全信息!");
            return false
        }
        if($("[name=send_frequency]").val()==""||$("[name=send_frequency]").val()==0){
            alert("请补全信息!");
            return false
        }
        return true
    }
    function setDel(id){
        $("#del").val(id);
    }
    function Delzw(){
        location.href="delZwdyq?id="+ $("#del").val();
    }
    function backToTop(){
     $("html,body").animate({ scrollTop: 0 },500,function(){});
    }
    //删除订阅器
    function deleteSubscriber(subscriber_id){
        if(confirm('你确定要删除该订阅器吗？')){
            window.location = '?subscriber_id=' + subscriber_id;
        }
    }
    //得到修改的数据
    function getUpdateData(subscriber_id){
        $(".xzzwdyq").show();
        $.ajax({
            type: 'POST',
            url: '/ajax_getSubscriberById',
            data: {"subscriber_id": subscriber_id},
            dataType: 'json',
            success: function(data){
                if(!data.msg){
                    $('input[name="subscriber_id"]:eq(0)').val(data.id);
                    $('input[name="subscriber_name"]:eq(0)').val(data.subscriber_name);
{#                    $('input[name="industry_name"]:eq(0)').val(data.industry);#}
                    $('input[name="industry_type"]:eq(0)').val(data.industry_type);
                    $('input[name="postaion_type"]:eq(0)').val(data.postaion_type);
{#                    $('#major').val(data.postaion);#}
                    $('#BusinessulControls').remove();
                    $('#PositionControls').remove();
                    BusinessulControls("businessulDiv", data.industry, data.industry_type, 'width:250px;margin-top:5px;font-size:14px;');
                    PositionControls("positionDiv", data.postaion, data.postaion_type, 'width:250px;margin-top:5px;font-size:14px;');
                    $('input[name="workarea"]:eq(0)').val(data.areaName);
                    $('input[name="work_area"]:eq(0)').val(data.work_area);
                    //$('#salary').val(data.pay);
                    if($('#salary').text().indexOf(data.pay_name) != -1){
                        $('#salary').val(data.pay);
                    }else{
                        $('#salary').children('option:first').text(data.pay_name);
                    }
                    $('input[name="keywords"]:eq(0)').val(data.keywords);
                    $("html,body").animate({ scrollTop: $("h4:eq(0)").offset().top},500,function(){});
                }
            }
        });
    }
    //点击新增职位订阅器时清空下面操作的数据
    function resetOperateData(){
        $(".xzzwdyq").show();
        $('#businessulDiv').children(':gt(0)').remove();
        $('#positionDiv').children(':gt(0)').remove();
        document.getElementById("add").reset();
        $('input[name="subscriber_id"]').val('');
        $("html,body").animate({ scrollTop: $("h4:eq(0)").offset().top},500,function(){});
    }
    //预览搜索效果
    function viewSearch(){
        var viewSql = '';
        var position = $('input[name="postaion_type"]:eq(0)').val();
        var work_area = $('input[name="work_area"]:eq(0)').val();
        var salary = $('#salary').val();
        var keywords = $('input[name="keywords"]:eq(0)').val();
        if(position != ''){
            viewSql += ' and find_in_set(cast(postaion_type as char), "'+position+'") ';
        }
        if(work_area != ''){
            viewSql += ' and find_in_set(cast(work_area as char), "'+work_area+'") ';
        }
        if($('#salary').children('option:selected').text() != '请选择'){
            //年薪范围处理
            var payname = $('#salary').children('option:selected').text();
            if(payname.indexOf('以上') != -1){
                viewSql += ' and (start_salary is not null and end_salary is null';
            }else if(payname.indexOf('以下') != -1){
                viewSql += ' and (start_salary is null and end_salary is not null';
            }else{
                var start_salary = payname.split('-')[0];
                var end_salary = payname.split('-')[1].split('万')[0];
                viewSql += ' and (start_salary < ' + end_salary + ' and end_salary > ' + start_salary + ')';
            }
        }
        if(salary != ''){
            viewSql += ' and pay= "'+salary+'" ';
        }
{#        if(keywords != ''){#}
{#            viewSql += 'nkeywords like';#}
{#        }#}
        window.open('/position/npositionsearch?viewSql=' + encodeURI(viewSql), '_blank');
    }
</script>
<!-- note

-->